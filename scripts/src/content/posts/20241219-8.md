---
title: "计算机网络ch4 网络层 数据平面"
published: 2024-12-19
tags: []
category: "计算机网络笔记"
draft: false
---
<h1>ch4 网络层 数据平面</h1>
<p>　　网络层将数据从源端经过若干中间结点传送到目的端</p>
<p>　　网络层向传输层提供最基本的端到端（发送端到接收端）的数据传送服务</p>
<h3>转发和路由选择：数据平面和控制平面</h3>
<p>　　网络层将分组从一台发送主机移动到一台接收主机，需要两种网络层功能：<br />
➢ 转发。当一个分组到达某路由器的一条输入链路时，该路由器必须将该分组移动到适当的输出链路。<br />
➢ 路由选择。当分组从发送方流向接收方时，网络层必须决定这些分组所采用的路由或路径即路由选择算法。</p>
<p>　　“转发”就是路由器根据转发表将用户的 IP 数据报从合适的端口转发出去。<br />
◼ “路由选择”则是按照分布式算法，根据从各相邻路由器得到的关于网络拓扑的变化情况，动态地改变所选择的路由。<br />
◼ <strong>路由表是根据路由选择算法得出的。而转发表是从路由表得出的</strong></p>
<h3>具体例子</h3>
<p>　　假设你要从你的家（发送方）发送一封信到你的朋友的家（接收方）：</p>
<ol>
<li>
<p><strong>转发</strong>：</p>
<ul>
<li>你的信从你家出发，首先送到最近的邮局（路由器 A）。邮局 A 接收到信件后，看到这封信的目的地是朋友的家，于是决定把信件放到去往邮局 B 的车上（输出链路），然后信件就被转发到下一个邮局。</li>
</ul>
</li>
<li>
<p><strong>路由选择</strong>：</p>
<ul>
<li>在邮局 A，工作人员需要决定把信件送往哪个邮局（例如邮局 B 或邮局 C）。他们会根据路况、天气情况等来判断，是选择邮局 B 的路线（可能较快但距离较远），还是邮局 C 的路线（可能较慢但距离较近）。这个决策过程就是路由选择。</li>
</ul>
</li>
</ol>
<h3>总结</h3>
<ul>
<li><strong>转发</strong>是一个具体的操作，负责将数据包从一个链路转移到另一个链路。</li>
<li><strong>路由选择</strong>是一个决策过程，负责选择数据包的传输路径。</li>
</ul>
<p>　　这两者是互补的：转发依赖于路由选择的结果，路由选择则决定了数据包如何通过网络进行转发。</p>
<p>　　‍</p>
<p>　　‍</p>
<p>　　<strong>时延上界</strong>：</p>
<ul>
<li>这是指在数据包传输过程中，网络服务能够保证数据包在一个特定的时间范围内（上限）到达接收方。换句话说，服务提供者承诺不会超过这个时间限制。</li>
</ul>
<p>　　考虑网络层能提供的某些可能的服务。包括：<br />
⚫ 确保交付。该服务确保分组将最终到达目的地。<br />
⚫ 具有时延上界的确保交付。该服务不仅确保分组的交付，而且在特定的主机到主机时延上界内交付。<br />
⚫ 有序分组交付。该服务确保分组以它们发送的顺序到达目的。<br />
⚫ 确保最小带宽。这种网络层服务模仿在发送和接收主机之间一条特定比特率的传输链路的行为。<br />
⚫ 安全性。网络层能够在源加密所有数据报并在目的地解密这些分组，从而对所有运输层报文段提供机密性。</p>
<h3>网络服务模型</h3>
<p>　　因特网的网络层提供了单一的服务，称为尽力而为服务（best effort service）。使用尽力而为服务，传送的分组既不能保证以它们发送的顺序被接收，也不能保证它们最终交付；既不能保证端到端时延，也不能保证有最小的带宽</p>
<p>​<img src="http://127.0.0.1:6806/assets/image-20241212152932-2dyb1wj.png" alt="image" />​</p>
<p>　　➢路由控制：网络层必须确定分组从发送主机流向接收主机所走的路由或路径。<br />
➢拥塞控制：网络交通拥塞会增加延迟，从而降低吞吐量。节点要调节分组通过网络的流动。<br />
➢异种网络的互联：解决不同网络在寻址、分组大小、协议等方面的差异。<br />
➢分组生成和装配：传输层报文与网络层分组间的转换</p>
<h3>异种网络的互联</h3>
<p>　　<strong>定义</strong>：不同的网络可能在地址格式、分组大小、协议等方面存在差异。网络层的功能之一是处理这些差异，使得不同网络能够互相通信。</p>
<p>　　<strong>例子</strong>：假设你有一个使用IPv4的网络和一个使用IPv6的网络。异种网络互联就像一个翻译官，能够将不同语言之间的对话顺利进行，确保两种网络能够理解彼此的信息。</p>
<h3>4. 分组生成和装配</h3>
<p>　　<strong>定义</strong>：这一功能涉及到将传输层数据（报文）转换为网络层数据（分组）和将分组重新装配为完整的报文。分组是网络层传输数据的基本单位。</p>
<p>　　<strong>例子</strong>：可以想象成邮递员在分发邮件。发送时，邮递员将信件（报文）分装到不同的包裹（分组）中，接收时，会把这些包裹拆开并重新组合成完整的信件。</p>
<h3>5. 分组是什么？</h3>
<p>　　数据单位</p>
<p>　　<strong>定义</strong>：分组是网络层传输数据的基本单位。它由网络层添加头部信息（如源地址、目的地址等）和数据组成。分组的大小通常是固定的，以便于在网络中传输。</p>
<p>　　<strong>例子</strong>：继续用邮递的例子，分组就像是一个个包裹，每个包裹里包含了一些信息和一封信。每个包裹都需要一个地址标签（头部信息），以便于邮递员知道要将其送到哪里。</p>
<h3>总结</h3>
<ul>
<li><strong>路由控制</strong>：确定最佳传输路径。</li>
<li><strong>拥塞控制</strong>：调节流量以减少延迟。</li>
<li><strong>异种网络的互联</strong>：处理不同网络间的差异。</li>
<li><strong>分组生成和装配</strong>：将报文与分组之间进行转换。</li>
<li><strong>分组</strong>：网络层传输数据的基本单位。</li>
</ul>
<p>​<img src="http://127.0.0.1:6806/assets/image-20241212153121-0vxhitw.png" alt="image" />​</p>
<p>​<img src="http://127.0.0.1:6806/assets/image-20241212154154-vthepkv.png" alt="image" />​</p>
<p>　　‍</p>
<p>　　<strong>输入端口对线路上收到的分组处理</strong></p>
<p>　　数据链路层剥去帧首部和尾部后，将分组送到网络层的队列中排队等待处理。这会产生一定的时延</p>
<p>​<img src="http://127.0.0.1:6806/assets/image-20241212154236-t5nmtsr.png" alt="image" />​</p>
<p>　　<strong>输出端口将交换结构传送来的分组发送到线路</strong></p>
<p>　　当交换结构传送过来的分组先进行缓存。数据链路层处理模块将分组加上链路层的首部和尾部，交给物理层后发送到外部线路。</p>
<p>​<img src="http://127.0.0.1:6806/assets/image-20241212154315-4b78n64.png" alt="image" />​</p>
<h3>分组丢弃</h3>
<p>　　路由器中的输入或输出队列产生溢出是造成分组丢失的重要原因</p>
<p>　　‍</p>
<p>　　‍</p>
<h3>输入端口处理和基于目的地转发</h3>
<p>　　输入端口（物理层和链路层）路由器使用转发表查找输出端口，使得到达的分组能经过交换结构转发到该输出端口</p>
<p>​<img src="http://127.0.0.1:6806/assets/image-20241212155914-ufrqs2x.png" alt="image" />​</p>
<h3>最长前缀匹配的基本概念</h3>
<ol>
<li>
<p><strong>前缀</strong>：</p>
<ul>
<li>在IP地址中，前缀是指IP地址的部分，通常以斜杠后跟数字的形式表示，比如 <code>192.168.1.0/24</code>​。这里的 <code>/24</code>​ 指的是前24位是网络部分。</li>
</ul>
</li>
<li>
<p><strong>匹配规则</strong>：</p>
<ul>
<li>当路由器收到一个数据包时，它会查看目的IP地址，并在路由表中找到所有可能的路由条目。路由器会选择与目的IP地址匹配的最长前缀。</li>
</ul>
</li>
</ol>
<h3>工作原理</h3>
<ol>
<li>
<p><strong>路由表</strong>：</p>
<ul>
<li>|路由表||<table>
<thead>
<tr>
<th>前缀</th>
<th>下一跳</th>
</tr>
</thead>
<tbody>
<tr>
<td>192.168.1.0/24</td>
<td>Next Hop A</td>
</tr>
<tr>
<td>192.168.0.0/16</td>
<td>Next Hop B</td>
</tr>
<tr>
<td>192.0.0.0/8</td>
<td>Next Hop C</td>
</tr>
</tbody>
</table>
</li>
</ul>
</li>
<li>
<p><strong>接收数据包</strong>：</p>
<ul>
<li>假设路由器收到一个目标IP地址为 <strong>192.168.1.10</strong> 的数据包。</li>
</ul>
</li>
<li>
<p><strong>查找匹配</strong>：</p>
<ul>
<li>
<p>路由器会查找路由表，找出所有与目标IP地址匹配的前缀：</p>
<ul>
<li><strong>192.168.1.0/24</strong>：匹配，因为192.168.1.10的前24位是192.168.1。</li>
<li><strong>192.168.0.0/16</strong>：也匹配，因为192.168.1.10的前16位是192.168。</li>
<li><strong>192.0.0.0/8</strong>：也匹配，但仅前8位是192。</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>选择最长前缀</strong>：</p>
<ul>
<li>在这三个匹配的前缀中，<strong>192.168.1.0/24</strong> 的前缀长度（24）最长。因此，路由器选择 <strong>Next Hop A</strong> 作为下一跳。</li>
</ul>
</li>
</ol>
<h3>另一个例子</h3>
<p>　　假设你的路由表是这样的：</p>
<table>
<thead>
<tr>
<th>前缀</th>
<th>下一跳</th>
</tr>
</thead>
<tbody>
<tr>
<td>10.0.0.0/8</td>
<td>Next Hop D</td>
</tr>
<tr>
<td>10.1.0.0/16</td>
<td>Next Hop E</td>
</tr>
<tr>
<td>10.1.2.0/24</td>
<td>Next Hop F</td>
</tr>
</tbody>
</table>
<ul>
<li>
<p>如果目标IP是 <strong>10.1.2.5</strong>：</p>
<ul>
<li><strong>10.0.0.0/8</strong>：匹配（前8位）。</li>
<li><strong>10.1.0.0/16</strong>：匹配（前16位）。</li>
<li><strong>10.1.2.0/24</strong>：匹配（前24位）。</li>
</ul>
</li>
</ul>
<p>　　在这个例子中，<strong>10.1.2.0/24</strong> 的前缀长度最长，因此路由器选择 <strong>Next Hop F</strong>。</p>
<h3>总结</h3>
<ul>
<li><strong>匹配过程</strong>：路由器会查看目标IP地址，找到所有匹配的前缀。</li>
<li><strong>选择过程</strong>：从所有匹配的前缀中选择长度最长的那个前缀。</li>
</ul>
<p>　　‍</p>
<h3>交换</h3>
<p>　　<strong>交换结构</strong>位于一台路由器的<strong>核心部位</strong>, 因为正是通过这种交换结构, 分组才能实际地从一个输入端口交换（即<strong>转发</strong>）到一个输出端口中。交换可以用许多方式完成</p>
<p>​<img src="http://127.0.0.1:6806/assets/image-20241212155250-x9pthy4.png" alt="image" />​</p>
<h4>经内存交换：</h4>
<p>　　⚫ 最简单、最早的路由器是传统的计算机。<br />
⚫ 在输入端口与输出端口之间的交换是在CPU的直接控制下<br />
完成的。<br />
⚫ 输入与输出端口的功能就像在传统操作系统中的I/O设备<br />
一样。<br />
⚫ 一个分组到达一个输入端口时，该端口会先通过中断方式<br />
向路由选择处理器发出信号。</p>
<p>　　‍</p>
<h4>经总线交换：</h4>
<p>　　⚫ 输入端口经一根共享总线将分组直接传送到输出端口，不<br />
需要路由选择处理器的干预。<br />
⚫ 通常按以下方式完成该任务：让输入端口为分组预先计划<br />
一个交换机内部标签，指示本地输出端口。<br />
⚫ 如果多个分组同时到达路由器，每个位于不同的输出端口<br />
，除了一个分组外所有其他分组必须等待，因为一次只有<br />
一个分组能够跨越总线。</p>
<p>　　‍</p>
<h4>经互联网交换：纵横式网络能够并行转发多个分组</h4>
<p>　　互连在一起的网络要进行通信，会遇到许多问题需要<br />
解决，如：<br />
◼ 不同的寻址方案<br />
◼ 不同的最大分组长度<br />
◼ 不同的网络接入机制<br />
◼ 不同的超时控制<br />
◼ 不同的差错恢复方法<br />
◼ 不同的状态报告方法<br />
◼ 不同的路由选择技术<br />
◼ 不同的用户接入控制<br />
◼ 不同的服务（面向连接服务和无连接服务）<br />
◼ 不同的管理与控制方式</p>
<hr />
<p>　　<strong>中间设备</strong>又称为<strong>中间系统</strong>或<strong>中继</strong>(relay)系统。<br />
◼ 物理层中继系统：<strong>转发器(</strong> repeater)。<br />
◼ 数据链路层中继系统：<strong>网桥或桥接器(</strong> bridge)。<br />
◼ 网络层中继系统：<strong>路由器</strong>(router)。<br />
◼ 网桥和路由器的混合物：<strong>桥路器(</strong> brouter)。<br />
◼ 网络层以上的中继系统：<strong>网关</strong>(gateway)。</p>
<p>　　‍</p>
<p>　　<strong>互联网都是指用路由器进行互连的网络</strong></p>
<p>　　‍</p>
<p>​<img src="http://127.0.0.1:6806/assets/image-20241212155623-bib92q2.png" alt="image" />​</p>
<p>　　虚拟互连网络的意义</p>
<p>　　虚拟互连网络指逻辑互连网络，就是互连起来的各种物理网络的异构性本来是客观存在的。</p>
<p>　　使用虚拟互连网络的好处：当互联网上的主机进行通信时，就好像在一个网络上通信一样，而看不见互连的各具体的网络异构细节。</p>
<p>　　‍</p>
<h3>输出端口处理</h3>
<p>　　‍</p>
<p>　　输出端口处理取出已经存放在<strong>输出端口内存（缓存管理）</strong> 中的分组并将其发送到输出链路上。这包括选择和取岀排队的分组进行传输，执行所需的<strong>链路层和物理层</strong>传输功能</p>
<p>​<img src="http://127.0.0.1:6806/assets/image-20241212155926-r63l631.png" alt="image" />​</p>
<h3>排队</h3>
<p>　　<strong>在输入端口和输出端口处</strong>都可以形成分组队列，就像在环状交叉路的类比。排<strong>队的位置和程度将取决于流量负载、交换结构的相对速率和线路速率</strong>。</p>
<p>　　随着这些队列的增长，路由器的缓存空间最终将会耗尽，并且当无内存可用于存储到达的分组时将会出现丢包。</p>
<p>　　‍</p>
<p>　　分组按FCFS方式，从一指定输入队列移动到其要求的输出队列中。<strong>只要其输出端口不同，多个分组可以被并行传送。</strong></p>
<p>　　一般的排队算法都是先来先服务(FCFS)，也是先进先出(FIFO)。</p>
<p>　　‍</p>
<h3>分组调度</h3>
<p>　　‍</p>
<p>　　非抢占式优先权排队：一旦分组传输，就不能打断</p>
<p>　　循环和加权公平排队</p>
<p>　　在循环排队规则下，分组像使用优先权那样被分类</p>
<p>　　以循环的方式为各个类提供服务，即首先服务第1类，然后服务第2类，接着再服务第3类，然后重复这种服务模式</p>
<p>​<img src="http://127.0.0.1:6806/assets/image-20241212160647-04zxlnh.png" alt="image" />​</p>
<h2>IP</h2>
<p>　　网际协议IP是TCP/IP体系中两个最主要的协议之一，与IP<br />
协议配套使用的还有四个协议：<br />
◼地址解析协议 ARP<br />
◼逆地址解析协议 RARP<br />
◼因特网控制报文协议 ICMP<br />
◼因特网组管理协议 IGMP</p>
<p>​<img src="http://127.0.0.1:6806/assets/image-20241212160738-l7xxiq4.png" alt="image" />​</p>
<p>　　◼一个IP数据报由首部和数据两部分组成。<br />
◼ 首部的前一部分是固定长度，<strong>共20字节</strong>，是所有IP数据报必须具有的。<br />
◼ 在首部的固定部分的后面是一些可选字段，其长度是可变的</p>
<p>​<img src="http://127.0.0.1:6806/assets/image-20241212160838-kzwv5f8.png" alt="image" />​</p>
<p>​<img src="http://127.0.0.1:6806/assets/image-20241212160849-dj0h78z.png" alt="image" />​</p>
<p>　　源地址和目的地址都各占 4 字节</p>
<p>　　‍</p>
<h3>IP 数据报首部的可变部分</h3>
<p>　　◼ IP首部的可变部分就是一个<strong>选项字段</strong>，用来支持排错、测量以及安全等措施，内容很丰富。<br />
◼ 选项字段的长度可变，从1个字节到40个字节不等，取决于所选择的项目。<br />
◼ 增加首部的可变部分是为了<strong>增加IP数据报的功能</strong>。<br />
◼ 实际上这些选项很少被使用。</p>
<p>　　‍</p>
<h3>IPv4数据报分片</h3>
<p>　　一个链路层帧能承载的最大数据量是最大传送单元<strong>MTU</strong>，以太网帧能够承载<strong>不超过1500字节</strong>的数据。<br />
◼ 将过大IP分组挤进链路层帧的有效载荷字段？将IP数据报中的数据<strong>分片</strong>成两个或更多个较小的IP数据报。<br />
◼ 为保持网络内核简单的原则，将数据报的重装工作放到<strong>端系统</strong>，而不是在路由器。<br />
◼ 为执行重装，</p>
<p>　　<strong>标识号</strong>：<span data-type="text" style="background-color: var(--b3-font-background1);">确定哪些数据报实际上是同一较大数<br />
据报的片</span>；</p>
<p>　　<strong>标志</strong>：是否收到最后一个片，标志比特设为0；</p>
<p>　　<strong>片<br />
偏移</strong>：确定是否丢失片。</p>
<p>　　‍</p>
<p>　　一个4000字节的数据报到<br />
达一台路由器，且必须被<br />
转发到一条MTU为1500<br />
字节的链路上。这就意味<br />
着初始数据报中<strong>3980字节<br />
数据</strong>必须被分配为3个独<br />
立的片。</p>
<ul>
<li class="vditor-task"><input disabled="" type="checkbox" /> <strong>首部前有20字节</strong></li>
</ul>
<p>　　‍</p>
<h3>IPv4编址</h3>
<p>　　◼ 主机和路由器连入网络的方法<br />
⚫ 一台主机通常只有一条链路连接到网络。<br />
⚫ 当主机中的IP想发送一个数据报时，它就在该链路上发送。主机与物理链路之间的边界叫作接口。<br />
⚫ 路由器与它的任意一条链路之间的边界也叫作接口。一台路由器因此有多个接口，每个接口有其链路。<br />
⚫ 一个IP地址与一个接口相关联，而不是与包括该接口的主机或路由器相关联。</p>
<h4>1. IP 地址及其表示方法</h4>
<p>　　IP地址就是给每个连接在因特网上的主机分配一个在全世界范围是惟一的32bit的标识符</p>
<p>　　IP 地 址 现 在 由 因 特 网 名 字 与 号 码 指 派 公 司ICANN进行分配。</p>
<h4>IP地址的编址方法</h4>
<p>　　◼ <strong>分类的IP地址</strong>。这是最基本的编址方法，在1981年就通过了相应的标准协议。<br />
◼ <strong>子网的划分</strong>。这是对最基本的编址方法的改进，其标准[RFC 950]在1985年通过。<br />
◼ <strong>构成超网</strong>。这是无分类编址方法。1993年提出后很快就得到推广应用。</p>
<h4>分类IP地址</h4>
<p>　　每一类地址都由两个固定长度的字段组成，其中一个字段是<strong>网络号net-id，</strong> 它标志主机所连接到的网络，而另一个字段则是<strong>主机号host-id</strong>，它标志该主机。<br />
◼ 两级的 IP 地址可以记为：<br />
IP 地址 ::= { <网络号>, <主机号>}</p>
<p>　　6<img src="http://127.0.0.1:6806/assets/image-20241212162308-37wa5ti.png" alt="image" />​</p>
<p>　　A类：网络号字段 1字节  主机号 3字节</p>
<p>​<img src="http://127.0.0.1:6806/assets/image-20241212162419-rfbkrx3.png" alt="image" />​</p>
<p>　　 <strong>A类地址可供使用的网络号是126个（即2^7-2）。</strong><br />
 第一，IP地址中的全0表示是“本网络”；<br />
 第二，net-id字段127（即01111111）保留，作为本地软件环回测<br />
试本主机之用。</p>
<p>　　‍</p>
<p>　　<strong> A类地址的host-id字段为3个字节，因此每一个A类网络中的最大主机数是16777214（即2^24 -2）。</strong><br />
 全0host-id字段表示该IP地址是“本主机”所连接的单个网络地<br />
址。<br />
 全1表示该网络上的所有主机。</p>
<p>​<img src="http://127.0.0.1:6806/assets/image-20241212162542-d63w1co.png" alt="image" />​</p>
<p>　　 B类地址的net-id字段占2个字节，但前面2位（10）已经固定了<br />
，只剩下14位可以变化，因此B类地址的网络数为16384（即2^14<br />
）。<br />
 B类地址的每一个网络上的最大主机数是65534（即2^16-2）。这<br />
里需要减2是因为要扣除全0和全1的主机号。</p>
<p>​<img src="http://127.0.0.1:6806/assets/image-20241212162618-2khdzns.png" alt="image" />​</p>
<p>　　 C类地址有3个字节的net-id字段，最前面的3位是110，还有21位可以变化，因此C类地址的网络总数是2097152（即221）。<br />
 每一个C类地址的最大主机数是254（即28-2）。</p>
<p>​<img src="http://127.0.0.1:6806/assets/image-20241212162637-nslz8dd.png" alt="image" />​</p>
<h3>点分十进制记法</h3>
<p>　　即地址中的每个字节用它的十进制形式书写，各字节间以句点隔开。<br />
例：IP地址193.32.216.9, 193是该地址的第一个8比特的十进制等价数，32是该地址的第二个8比特的十进制等价数，依次类推。地址193.32.216.9的二进制记法是:<br />
11000001 00100000 11011000 00001001。</p>
<p>​<img src="http://127.0.0.1:6806/assets/image-20241212162730-354ci2c.png" alt="image" />​</p>
<p>　　 <strong>(1)IP 地址是一种分等级的地址结构。分两个等级的好处是</strong></p>
<p>　　◼ 第一，IP地址管理机构在分配IP地址时只分配网络号，而<br />
剩下的主机号则由得到该网络号的单位自行分配。这样就<br />
方便了IP地址的管理。<br />
◼ 第二，路由器仅根据目的主机所连接的网络号来转发分组，<br />
这样就可以使路由表中的项目数大幅度减少，从而减小了<br />
路由表所占的存储空间。</p>
<p>　　（2）实际上IP地址是标志一个主机（或路由器）和一条链路的接口。<br />
◼ 当一个主机同时连接到两个网络上时，该主机就必须同<br />
时具有两个相应的IP地址，其网络号net-id必须是不同<br />
的。这种主机称为多接口主机。<br />
◼ 由于一个路由器至少应当连接到两个网络，<strong>因此一个路<br />
由器至少应当有两个不同的IP地址。</strong></p>
<p>　　(3) 用转发器或网桥连接起来的若干个局域网仍为一个网<br />
络，因此这些局域网都具有同样的网络号net-id。<br />
(4) 所有分配到网络号net-id的网络，范围很小的局域网，<br />
还是可能覆盖很大地理范围的广域网，都是平等的。</p>
<h4>路由器转发分组的步骤</h4>
<p>　　◼<br />
先按所要找的IP地址中的网络号net-id把目<br />
的网络找到。<br />
◼<br />
当分组到达目的网络后，再利用主机号host-<br />
id将数据报直接交付给目的主机。<br />
◼<br />
按照整数字节划分net-id字段和host-id字段。</p>
<p>​<img src="http://127.0.0.1:6806/assets/image-20241212162943-qn2cla0.png" alt="image" />​</p>
<p>　　路由器总是具有两个或两个以上的 IP 地址。<br />
路由器的每一个接口都有一个<br />
不同网络号的 IP 地址</p>
<p>　　两个路由器直接相连的接口处，可指明也可不指明<br />
IP 地址。如指明 IP 地址，则这一段连线就构成了<br />
一种只包含一段线路的特殊“网络”。现在常不指<br />
明IP地址。</p>
<p>​<img src="http://127.0.0.1:6806/assets/image-20241212163037-m8qmihb.png" alt="image" />​</p>
<p>　　‍</p>
<p>　　‍</p>
<p>　　‍</p>
<p>　　‍</p>
<p>　　路由器只根据目的站的 IP 地址的网络号进行路由选择</p>
<p>　　在具体的物理网络的链路层<br />
只能看见 MAC 帧而看不见 IP 数据报</p>
<p>　　IP层抽象的互联网屏蔽了下层很复杂的细节<br />
在抽象的网络层上讨论问题，就能够使用<br />
统一的、抽象的 IP 地址<br />
研究主机和主机或主机和路由器之间的通信</p>
<h3>地址解析协议ARP和逆地址解析协议RARP</h3>
<p>　　◼ 不管网络层使用的是什么协议，在实际网络的链路上传送<strong>数据帧</strong>时，最终还是必须使用<strong>硬件地址。</strong><br />
◼ 每一个主机都设有一个<strong>ARP高速缓存</strong>，里面有所在的局域网上的各主机和路由器的<strong>IP地址到硬件地址的映射表</strong>。<br />
◼ 当主机A欲向<strong>本局域网</strong>上的某个主机B发送IP数据报时，就先在其<strong>ARP高速缓存</strong>中查看有无主机B的IP地址。</p>
<p>​<img src="http://127.0.0.1:6806/assets/image-20241212163337-5wcncxc.png" alt="image" />​</p>
<p>　　◼ 为了<strong>减少网络上的通信量，</strong> 主机A在发送其ARP请求分组时，就将自己的<strong>IP地址到硬件地址的映</strong>射写入ARP请求分组。<br />
◼ 当主机B收到A的ARP请求分组时，就将主机A 的这一地址映射写入主机B自己的<strong>ARP高速缓存中。</strong> 这对主机B以后向A发送数据报时就更方便。</p>
<p>　　◼ <strong>ARP是解决同一个局域网上的主机或路由器的IP地址和硬件地址的映射问题。</strong></p>
<p>　　◼ <strong>如果所要找的主机和源主机不在同一个局域网上，</strong> 那么就要通过<strong>ARP</strong>找到一个位于本局域网上的某个<strong>路由器的硬件地址，</strong> 然后把分组发送给这个路由器，让这个路由器把分组转发给下一个网络。</p>
<p>　　◼ <strong>从IP地址到硬件地址的解析是自动进行</strong>的，主机的用户对这种地址解析过程是不知道的</p>
<p>　　◼ <strong>只要主机或路由器</strong>要和本网络上的另一个已知IP地址的主机或路由器进行通信，ARP协议就会自动地将该IP地址解析为链路层所需要的硬件地址。</p>
<h4>为什么我们不直接使用硬件地址进行通信？</h4>
<p>　　◼ 由于全世界存在着各式各样的网络，它们使用不同的硬件地址。要使这些<strong>异构网络</strong>能够互相通信就必须进行非常复杂的<strong>硬件地址转换工作</strong>，这几乎是不可能的事。</p>
<p>　　◼ 连接到因特网的主机都拥有统一的IP地址，<strong>调用ARP</strong>来寻找某个路由器或主机的硬件地址都是由计算机软件自动进行的。</p>
<h4>逆地址解析协议RARP</h4>
<p>　　◼ 逆地址解析协议RARP使只知道自己硬件地址的主机能够知道其IP地址。<br />
◼ 这种主机往往是无盘工作站。 因此RARP协议目前已很少使用。</p>
<h3>虚拟专用网VPN和网络地址转换NAT</h3>
<p>　　1.VPN</p>
<p>　　◼10.0.0.0 到 10.255.255.255<br />
◼172.16.0.0 到 172.31.255.255<br />
◼192.168.0.0 到 192.168.255.255<br />
◼这些地址只能用于<strong>一个机构的内部通信</strong>，而不能用于和因特网上的主机通信。<br />
*<u>使用专用IP地址的互联网称为</u><em>​</em><u><strong>专用网，</strong></u><em>​</em><u>专用IP地址也叫做</u><em>​</em><u><strong>可重用地址</strong></u>*​ <em><u>。</u></em><br />
◼专用地址只能用作<strong>本地地址</strong>而不能用作全球地址。在因特网中的所有路由器对目的地址是专用地址的数据报一律不进行转发。</p>
<p>　　‍</p>
<p>　　◼ 虚拟专用网络（Virtual Private Network，VPN）是一种通<br />
过公共网络（如互联网）建立加密连接的技术，用于在远程<br />
位置之间安全地传输数据。<br />
◼ VPN<br />
可以在用户计算机和远程服务器之间建立一条虚拟的、<br />
加密的通道，使得用户的数据在传输过程中得以加密保护，<br />
同时也能够实现对用户的身份、位置等隐私信息的保护。</p>
<p>　　<strong>用隧道技术实现虚拟专用网</strong></p>
<p>​<img src="http://127.0.0.1:6806/assets/image-20241212164015-d6du6wm.png" alt="image" />​</p>
<p>　　<strong>内联网 Intranet 和外联网 Extranet（都是基于TCP/IP协议）</strong></p>
<p>　　◼ 由部门 A 和 B 的内部网络所构成的虚拟专用网 VPN 又称<br />
为内联网(Intranet)，表示部门 A 和 B 都是在同一个机构<br />
的内部。<br />
◼ 一个机构和某些外部机构共同建立的虚拟专用网 VPN 又称<br />
为外联网(Extranet)。</p>
<h3>网络地址转换NAT</h3>
<p>　　◼ 需要在专用网连接到因特网的路由器上安装NAT软件。装有NAT软件的路由器叫做NAT路由器，它至少有一个有效的外部全球地址 IPG。<br />
◼ 所有使用本地地址的主机在和外界通信时都要在NAT路由器上将其本地地址转换成IPG才能和因特网连接。</p>
<p>　　◼ 内部主机 X 用本地地址 IPX 和因特网上主机 Y 通信所发<br />
送的数据报必须经过 NAT 路由器。<br />
◼ NAT 路由器将数据报的源地址 IPX 转换成全球地址 IPG，<br />
但目的地址 IPY 保持不变，然后发送到因特网。<br />
◼ NAT 路由器收到主机 Y 发回的数据报时，知道数据报中<br />
的源地址是 IPY 而目的地址是 IPG。<br />
◼ 根据 NAT 转换表，NAT 路由器将目的地址 IPG 转换为<br />
IPX，转发给最终的内部主机 X。</p>
<p>​<img src="http://127.0.0.1:6806/assets/image-20241212164744-8covfu3.png" alt="image" />​</p>
<h3>IPv6</h3>
<ol>
<li>解决IP网络地址耗尽问题</li>
</ol>
<p>　　◼ 从计算机本身发展以及从因特网规模和网络传输速率来看，<br />
现在 IPv4 已很不适用。<br />
◼ 最主要的问题就是 <strong>32 bit 的 IP 地址不够用。</strong><br />
<strong>◼ 要解决 IP 地址耗尽的问题的措施：</strong><br />
◼ 采用无类别编址CIDR，使 IP 地址的分配更加合理。<br />
◼ 采用网络地址转换NAT方法以节省全球 IP 地址。<br />
◼ 采用具有更大地址空间的新版本的IP协议IPv6。</p>
<p>　　‍</p>
<p>　　IPv6 所引进的主要变化如下</p>
<p>　　‍</p>
<p>　　◼ 扩大的地址容量。<strong>IPv6 将地址从 IPv4 的 32 bit 增大到了 128bit。</strong><br />
◼ 扩展的地址层次结构。<br />
◼ 灵活的首部格式，简化高效的40字节首部。<br />
◼ 改进的选项。<br />
◼ 允许协议继续扩充。<br />
◼ 支持即插即用（即自动配置） 。<br />
◼ 支持资源的预分配。<br />
◼ 流标签及流量类型。</p>
<p>　　◼ IPv6 将首部长度变为固定的 40 字节，称为基本首部(baseheader)。<br />
◼ 将不必要的功能取消了，首部的字段数减少到只有 8 个。<br />
◼ 取消了首部的检验和字段，加快了路由器处理数据报的速度。<br />
◼ 在基本首部的后面允许有零个或多个扩展首部。<br />
◼ 所 有 的 扩 展 首 部 和 数 据 合 起 来 叫 做 数 据 报 的 有 效 载 荷(payload)或净负荷。</p>
<p>　　◼ 源地址和目的地址。IPv6 128 比特地址的各种格式在RFC4291中进行了描述 。<br />
◼ 数据。这是IPv6数据报有效载荷部分。当数据报到达目的地时，有效载荷就从IP数据报中移出， 并交给在“下一个首部”字段中指定协议处理 。<br />
◼ 分片 / 重新组装。IPv6不允许在中间路由器上进行分片与重新组装。这种操作只在源与目的地执行 。</p>
<p>　　◼ 选项。选项字段不再是标准IP首部的一部分了。但它并没有消失，而是可能出现在IPv6首部中由“下一个首部”指出的位置上。</p>
<p>​<img src="http://127.0.0.1:6806/assets/image-20241212165033-zzml14f.png" alt="image" />​</p>
<p>​<img src="http://127.0.0.1:6806/assets/image-20241212165057-0wxczw2.png" alt="image" />​</p>
<p>​<img src="http://127.0.0.1:6806/assets/image-20241212165103-e35kwid.png" alt="image" />​</p>
<ol start="3">
<li>IPv6 的扩展首部</li>
</ol>
<p>　　‍</p>
<p>​<img src="http://127.0.0.1:6806/assets/image-20241212165301-8s7r6z3.png" alt="image" />​</p>
<p>​<img src="http://127.0.0.1:6806/assets/image-20241212165358-bh089e7.png" alt="image" />​</p>
<p>　　IPv6 数据报的目的地址可以是以下三种基本类型地址之一：<br />
(1) 单播(unicast) ，单播就是传统的点对点通信。<br />
(2) 多播(multicast) ，多播是一点对多点的通信。<br />
(3) 任播(anycast) ，这是 IPv6 增加的一种类型。任播的目的站是一组计算机，但数据报在交付时只交付给其中的一个，通常是距离最近的一个。</p>
<p>　　◼ IPv6 将实现 IPv6 的主机和路由器均称为结点。<br />
◼ IPv6 地址是分配给结点上面的接口</p>
<p>　　◼ 一个接口可以有多个单播地址。<br />
◼ 一个结点接口的单播地址可用来惟一地标志<br />
该结点。</p>
<h4>冒号十六进制记法</h4>
<p>　　◼ 每个 16 bit 的值用十六进制值表示，各值之间用<br />
冒号分隔。<br />
68E6:8C64:FFFF:FFFF:0:1180:960A:FFFF<br />
◼ 零压缩(zero compression)，即一连串连续的<br />
零可以为一对冒号所取代。<br />
◼ FF05:0:0:0:0:0:0:B3 可以写成：<br />
◼ FF05::B3</p>
<p>　　◼ 0:0:0:0:0:0:128.10.2.1<br />
再使用零压缩即可得出： ::128.10.2.1<br />
◼ CIDR 的斜线表示法仍然可用。<br />
◼ 60 bit的前缀 12AB00000000CD3 可记为：<br />
12AB:0000:0000:CD30:0000:0000:0000:0000/60<br />
或12AB::CD30:0:0:0:0/60<br />
或12AB:0:0:CD30::/60</p>
<h3>CIDR 斜线表示法的含义</h3>
<ol>
<li>
<p><strong>斜线（/）</strong> ：</p>
<ul>
<li>在 CIDR 表示法中，斜线后面跟随的数字表示网络前缀的长度，也就是网络部分的位数。例如，在 <code>12AB:0000:0000:CD30:0000:0000:0000:0000/60</code>​ 中的 <code>/60</code>​ 表示前60位是网络部分。</li>
</ul>
</li>
<li>
<p><strong>前缀和主机部分</strong>：</p>
<ul>
<li>IP 地址可以分为两部分：前缀（网络部分）和主机部分。前缀用于标识网络，主机部分用于标识网络中的具体设备（主机）。</li>
<li>在这个例子中，前60位用于标识网络，后面的位数（在这种情况下是8位）用于标识该网络中的具体主机。</li>
</ul>
</li>
</ol>
<h4>前缀为 0000 0000 的地址</h4>
<p>　　◼ 前缀为 0000 0000 是保留一小部分地址与 IPv4<br />
兼容的，这是因为必须要考虑到在比较长的时期<br />
IPv 4和 IPv6 将会同时存在，而有的结点不支持<br />
IPv6。<br />
◼ 因此数据报在这两类结点之间转发时，就必须进<br />
行地址的转换。</p>
<p>​<img src="http://127.0.0.1:6806/assets/image-20241212165759-q2im4l0.png" alt="image" />​</p>
<p>　　32/128</p>
<p>　　‍</p>
<p>　　‍</p>
<h3>划分子网的基本思路</h3>
<p>　　◼ 划分子网纯属一个单位内部的事情。单位对外仍然表<br />
现为没有划分子网的网络。<br />
◼ 从主机号借用若干个比特作为子网号 subnet-id，而<br />
主机号 host-id 也就相应减少了若干个比特。</p>
<p>　　IP地址 ::= {<网络号>, <子网号>, <主机号>}</p>
<p>　　◼ 凡是从其他网络发送给本单位某个主机的 IP 数据报，<br />
仍然是根据 IP 数据报的目的网络号 net-id，先找<br />
到连接在本单位网络上的路由器。<br />
◼ 然后此路由器在收到 IP 数据报后，再按目的网络号<br />
net-id 和子网号 subnet-id 找到目的子网。<br />
◼ 最后就将 IP 数据报直接交付给目的主机。<br />
划分子网的基本思路</p>
<p>​<img src="http://127.0.0.1:6806/assets/image-20241212170112-abtwku8.png" alt="image" />​</p>
<p>​<img src="http://127.0.0.1:6806/assets/image-20241212170104-mi5mo1n.png" alt="image" />​</p>
<p>　　◼ 当没有划分子网时，IP 地址是两级结构，地址<br />
的网络号字段也就是 IP 地址的“因特网部分”，<br />
而主机号字段是 IP 地址的“本地部分”</p>
<p>　　◼ 划分子网后 IP 地址就变成了三级结构。划分子<br />
网只是将 IP 地址的本地部分进行再划分，而不<br />
改变 IP 地址的因特网部分。</p>
<h4>子网掩码</h4>
<p>　　◼ 从一个 I P数据报的首部并无法判断源主机或目<br />
的主机所连接的网络是否进行了子网的划分</p>
<p>　　◼ 使用子网掩码(subnet mask)可以找出 IP 地<br />
址中的子网部分。指明一个IP地址的哪些位标识的<br />
是主机所在的子网，以及哪些位标识的是主机的位掩码。</p>
<p>​<img src="http://127.0.0.1:6806/assets/image-20241212170216-i92mxvh.png" alt="image" />​</p>
<p>​<img src="http://127.0.0.1:6806/assets/image-20241212170230-iz58vi7.png" alt="image" />​</p>
<p>　　◼ 在不划分子网的两级 IP 地址下，从 IP 地址得出网<br />
络地址是个很简单的事。<br />
◼ 但在划分子网的情况下，从IP地址却不能惟一地得<br />
出网络地址，这是因为网络地址取决于那个网络所<br />
采用的子网掩码，但数据报的首部并没有提供子网<br />
掩码的信息。<br />
◼ 因此分组转发的算法也必须做相应的改动。</p>
<p>​<img src="http://127.0.0.1:6806/assets/image-20241212170934-eivil0y.png" alt="image" />​</p>
<h3>普通子网掩码</h3>
<ul>
<li>
<p><strong>类A、B、C</strong>：普通的子网掩码依赖于IP地址的类，通常有三个主要类别：</p>
<ul>
<li><strong>A类</strong>：子网掩码为 <code>255.0.0.0</code>​（/8）</li>
<li><strong>B类</strong>：子网掩码为 <code>255.255.0.0</code>​（/16）</li>
<li><strong>C类</strong>：子网掩码为 <code>255.255.255.0</code>​（/24）</li>
</ul>
</li>
</ul>
<p>　　在这些类别中，子网掩码是固定的，不能灵活调整。</p>
<h3>无分类编址（CIDR）</h3>
<ul>
<li>
<p><strong>灵活的子网掩码</strong>：CIDR允许使用任意长度的子网掩码。例如：</p>
<ul>
<li>​<code>255.255.255.128</code>​（/25）表示前25位为网络位，后7位为主机位。</li>
<li>​<code>255.255.254.0</code>​（/23）表示前23位为网络位，后9位为主机位。</li>
</ul>
</li>
</ul>
